# Feature Specification: Frontend Development Sandbox MVP

**Feature Branch**: `001-init-mvp`
**Created**: 2026-01-03
**Status**: Draft
**Input**: User description: "创建前端开发沙盒程序 MVP - 参考 Scrimba 实现实时代码编辑和预览功能"

## Overview

创建一个前端开发沙盒应用，允许用户在浏览器中编写 HTML、CSS 和 JavaScript 代码，并实时查看渲染结果。该应用参考 Scrimba 的设计，提供类似 IDE 的体验，但聚焦于前端开发测试场景。

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 编写代码并实时预览 (Priority: P1)

作为前端开发者，我希望能够在左侧编辑器中编写 HTML/CSS/JS 代码，并在右侧预览窗口中实时看到渲染效果，以便快速测试和验证我的代码。

**Why this priority**: 这是沙盒应用的核心功能，没有它应用就没有价值。实时预览是区别于普通文本编辑器的关键特性。

**Independent Test**: 可以通过在编辑器中输入 HTML 代码（如 `<h1>Hello World</h1>`），验证右侧预览窗口是否立即显示对应内容。

**Acceptance Scenarios**:

1. **Given** 用户打开应用，**When** 用户在编辑器中输入 `<h1>Hello</h1>`，**Then** 预览窗口在 500ms 内显示大标题 "Hello"
2. **Given** 用户已编写 HTML 结构，**When** 用户添加 CSS 样式 `h1 { color: red; }`，**Then** 预览窗口中的标题立即变为红色
3. **Given** 用户已编写 HTML 和按钮，**When** 用户添加 JavaScript 点击事件，**Then** 点击预览窗口中的按钮可触发相应功能

---

### User Story 2 - 多文件管理 (Priority: P2)

作为前端开发者，我希望能够创建和管理多个文件（如 index.html、styles.css、script.js），并在它们之间切换编辑，以便组织较复杂的项目结构。

**Why this priority**: 虽然单文件也能工作，但真实的前端项目通常需要分离关注点，支持多文件可以让用户测试更接近真实场景的代码。

**Independent Test**: 可以通过创建 3 个文件（HTML/CSS/JS），分别编辑并验证预览窗口正确加载所有文件内容。

**Acceptance Scenarios**:

1. **Given** 用户在应用中，**When** 用户点击"新建文件"并输入 `styles.css`，**Then** 文件列表中显示新文件，编辑器切换到该文件
2. **Given** 用户有多个文件，**When** 用户点击文件列表中的某个文件，**Then** 编辑器显示该文件的内容
3. **Given** 用户在 HTML 中引用了 CSS 文件 `<link href="styles.css">`，**When** 用户修改 styles.css 的内容，**Then** 预览窗口应用新的样式

---

### User Story 3 - 文件操作 (Priority: P3)

作为前端开发者，我希望能够重命名和删除不需要的文件，以便保持项目整洁。

**Why this priority**: 文件管理的补充功能，对于初始 MVP 不是必须的，但提升用户体验。

**Independent Test**: 可以通过创建文件、重命名、然后删除，验证文件列表正确更新。

**Acceptance Scenarios**:

1. **Given** 用户有一个名为 `test.js` 的文件，**When** 用户右键选择重命名并输入 `app.js`，**Then** 文件列表显示 `app.js`，原文件名消失
2. **Given** 用户有多个文件，**When** 用户删除一个非活动文件，**Then** 该文件从列表中移除，编辑器保持当前文件
3. **Given** 用户只有一个文件，**When** 用户尝试删除该文件，**Then** 系统提示"至少需要保留一个文件"

---

### User Story 4 - 项目持久化 (Priority: P4)

作为前端开发者，我希望我的代码能够自动保存到浏览器本地存储，这样刷新页面后不会丢失工作进度。

**Why this priority**: 对于 MVP 来说是"锦上添花"的功能，但对用户体验有重要影响。没有它用户仍然可以使用沙盒，只是需要每次重新输入代码。

**Independent Test**: 可以通过编写代码、刷新页面、验证代码是否恢复来测试。

**Acceptance Scenarios**:

1. **Given** 用户编写了代码，**When** 用户刷新浏览器，**Then** 页面加载后显示之前编写的代码
2. **Given** 用户创建了多个文件，**When** 用户刷新浏览器，**Then** 所有文件及其内容都被恢复

---

### Edge Cases

- **空文件处理**: 当文件内容为空时，预览窗口应显示空白页面而非错误
- **语法错误处理**: 当 JavaScript 有语法错误时，预览窗口应显示错误提示而非崩溃
- **大文件处理**: 当代码量较大（超过 10000 行）时，编辑器和预览不应明显卡顿
- **循环引用**: 当 JavaScript 代码导致无限循环时，系统应能检测并终止执行
- **特殊字符**: HTML 中的特殊字符（如 `<script>` 标签内的 `</script>` 字符串）应被正确处理
- **浏览器兼容性**: 应用应在主流现代浏览器（Chrome、Firefox、Safari、Edge）中正常工作

## Requirements *(mandatory)*

### Functional Requirements

**核心编辑功能**
- **FR-001**: 系统必须提供代码编辑器，支持 HTML、CSS、JavaScript 语法高亮
- **FR-002**: 编辑器必须支持基本编辑功能：复制、粘贴、撤销、重做
- **FR-003**: 编辑器必须显示行号

**实时预览功能**
- **FR-004**: 系统必须提供预览窗口，实时渲染用户编写的 HTML/CSS/JS 代码
- **FR-005**: 代码变更后，预览必须在 500ms 内更新（使用防抖机制）
- **FR-006**: 预览窗口必须与编辑器代码执行环境隔离（安全沙箱）

**文件管理功能**
- **FR-007**: 系统必须支持创建新文件，允许用户指定文件名和扩展名
- **FR-008**: 系统必须支持在多个文件之间切换
- **FR-009**: 系统必须支持重命名现有文件
- **FR-010**: 系统必须支持删除文件（保留至少一个文件）
- **FR-011**: 文件列表必须显示文件类型图标（HTML、CSS、JS、图片等）

**数据持久化**
- **FR-012**: 系统必须将用户代码自动保存到浏览器本地存储
- **FR-013**: 系统必须在页面加载时恢复上次保存的代码状态

**用户界面**
- **FR-014**: 界面必须采用三栏布局：左侧文件列表、中间代码编辑器、右侧预览窗口
- **FR-015**: 用户必须能够调整各栏的宽度
- **FR-016**: 系统必须提供深色主题（默认）

**错误处理**
- **FR-017**: 系统必须捕获 JavaScript 运行时错误并在控制台区域显示
- **FR-018**: 系统必须检测并终止无限循环执行（超时保护）

### Key Entities

- **Project（项目）**: 代表用户当前的工作空间，包含一组文件。属性：项目名称、创建时间、最后修改时间
- **File（文件）**: 项目中的单个文件。属性：文件名、文件类型（html/css/js/image）、内容、是否为入口文件
- **EditorState（编辑器状态）**: 编辑器的当前状态。属性：当前打开的文件、光标位置、选中内容
- **PreviewState（预览状态）**: 预览窗口的状态。属性：当前渲染的内容、错误信息、加载状态

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户能够在 30 秒内完成从打开应用到看到第一次代码预览的全流程
- **SC-002**: 代码编辑到预览更新的延迟不超过 500ms（用户感知为"即时"）
- **SC-003**: 应用能够流畅处理包含 5 个以上文件、每个文件 500 行代码的项目
- **SC-004**: 页面刷新后，100% 的用户代码和文件结构能够被正确恢复
- **SC-005**: 在主流现代浏览器（Chrome、Firefox、Safari、Edge 最新版本）中功能完全一致
- **SC-006**: 用户首次使用无需任何教程即可完成基本操作（编辑、预览、切换文件）

## Assumptions

1. **目标用户**: 有基础编程知识的前端开发者，熟悉 HTML/CSS/JS
2. **使用场景**: 快速测试代码片段、学习前端技术、分享代码示例
3. **部署方式**: 纯前端应用，无需后端服务器
4. **浏览器支持**: 仅支持现代浏览器，不考虑 IE 兼容性
5. **文件大小限制**: 单个文件不超过 1MB，总项目不超过 10MB
6. **网络依赖**: 初次加载需要网络，之后可离线使用（PWA 可选）

## Out of Scope (MVP 阶段不包含)

- 用户账号系统和云端同步
- 代码分享和协作功能
- NPM 包导入支持
- 代码格式化工具
- 版本控制（Git）集成
- 模板项目库
- 导出为 ZIP 文件
- 自定义主题
